#!/usr/bin/env bash

find . -name dependency-check-report.json \
 -exec jq '{"project": .projectInfo.name,
            "summary": [.dependencies[]
                        | {filePath,
                           description,
                           "severities": [.vulnerabilities[]?
                                         | {severity,name,description
                                           ,"score": .cvssv3.baseScore}
                                           | select(.score >= 4.0)
                                         ] | unique
                          } | select(.severities | length > 0)
                       ] | unique
           } | select(.summary | length > 0)' {} \; \
       | jq -s .
